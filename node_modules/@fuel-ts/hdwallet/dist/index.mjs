import{Base58 as v}from"@ethersproject/basex";import{hexDataSlice as w,hexlify as i,concat as f,hexZeroPad as m,arrayify as d}from"@ethersproject/bytes";import{computeHmac as U,ripemd160 as L,sha256 as y,SupportedAlgorithm as S}from"@ethersproject/sha2";import{toBigInt as b}from"@fuel-ts/math";import{Mnemonic as D}from"@fuel-ts/mnemonic";import{Signer as x}from"@fuel-ts/signer";var E=2147483648,k=i("0x0488ade4"),l=i("0x0488b21e"),C=i("0x04358394"),u=i("0x043587cf");function g(n){return v.encode(f([n,w(y(y(n)),0,4)]))}function R(n=!1,t=!1){return n?t?u:l:t?C:k}function M(n){return[l,u].includes(i(n.slice(0,4)))}function N(n){return[k,C,l,u].includes(i(n.slice(0,4)))}function V(n,t=0){let e=n.split("/");if(e.length===0||e[0]==="m"&&t!==0)throw new Error(`invalid path - ${n}`);return e[0]==="m"&&e.shift(),e.map(r=>~r.indexOf("'")?parseInt(r,10)+E:parseInt(r,10))}function T(n){let t=new Uint8Array(4);for(let e=24;e>=0;e-=8)t[0+(e>>3)]=n>>24-e&255;return t}var c=class{constructor(t){this.depth=0;this.index=0;this.fingerprint=i("0x00000000");this.parentFingerprint=i("0x00000000");if(t.privateKey){let e=new x(t.privateKey);this.publicKey=i(e.compressedPublicKey),this.privateKey=i(t.privateKey)}else{if(!t.publicKey)throw new Error("Public and Private Key are missing!");this.publicKey=i(t.publicKey)}this.parentFingerprint=t.parentFingerprint||this.parentFingerprint,this.fingerprint=w(L(y(this.publicKey)),0,4),this.depth=t.depth||this.depth,this.index=t.index||this.index,this.chainCode=t.chainCode}get extendedKey(){return this.toExtendedKey()}deriveIndex(t){let e=this.privateKey&&d(this.privateKey),r=d(this.publicKey),s=d(this.chainCode),o=new Uint8Array(37);if(t&E){if(!e)throw new Error("Derive hardened requires privateKey");o.set(e,1)}else o.set(d(this.publicKey));o.set(T(t),33);let p=d(U(S.sha512,s,o)),h=p.slice(0,32),a=p.slice(32);if(e){let P=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),B=d(m(i((b(h)+b(e))%P),32));return new c({privateKey:B,chainCode:a,index:t,depth:this.depth+1,parentFingerprint:this.fingerprint})}let I=new x(i(h)).addPoint(r);return new c({publicKey:I,chainCode:a,index:t,depth:this.depth+1,parentFingerprint:this.fingerprint})}derivePath(t){return V(t,this.depth).reduce((r,s)=>r.deriveIndex(s),this)}toExtendedKey(t=!1,e=!1){if(this.depth>=256)throw new Error("Depth too large!");let r=R(this.privateKey==null||t,e),s=i(this.depth),o=this.parentFingerprint,p=m(i(this.index),4),h=this.chainCode,a=this.privateKey!=null&&!t?f(["0x00",this.privateKey]):this.publicKey,K=f([r,s,o,p,h,a]);return g(K)}static fromSeed(t){let e=D.masterKeysFromSeed(t);return new c({chainCode:d(e.slice(32)),privateKey:d(e.slice(0,32))})}static fromExtendedKey(t){let e=v.decode(t),r=g(e.slice(0,78))===t;if(e.length!==82||!N(e))throw new Error("Invalid extended key");if(!r)throw new Error("Invalid checksum key");let s=e[4],o=i(e.slice(5,9)),p=parseInt(i(e.slice(9,13)).substring(2),16),h=i(e.slice(13,45)),a=e.slice(45,78);if(s===0&&o!=="0x00000000"||s===0&&p!==0)throw new Error("Invalid depth");if(M(e)){if(a[0]!==3)throw new Error("Invalid public extended key");return new c({publicKey:a,chainCode:h,index:p,depth:s,parentFingerprint:o})}if(a[0]!==0)throw new Error("Invalid private extended key");return new c({privateKey:a.slice(1),chainCode:h,index:p,depth:s,parentFingerprint:o})}},j=c;export{j as HDWallet};
//# sourceMappingURL=index.mjs.map